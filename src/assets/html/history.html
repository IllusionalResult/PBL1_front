<!DOCTYPE HTML>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="pragma" content="no-cache" />
    <meta http-equiv="cache-control" content="max-age=604800" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="author" content="Bootstrap-ecommerce by Vosidiy">

    <title>購入履歴</title>

    <!-- jQuery -->
    <script src="../js/bootstrap_js/jquery-2.0.0.min.js" type="text/javascript"></script>

    <!-- Bootstrap4 files-->
    <script src="../js/bootstrap_js/bootstrap.bundle.min.js" type="text/javascript"></script>
    <link href="../css/bootstrap_css/bootstrap.css" rel="stylesheet" type="text/css"/>

    <!-- Font awesome 5 -->
    <link href="../fonts/bootstrap_fonts/fontawesome/css/fontawesome-all.min.css" type="text/css" rel="stylesheet">

    <!-- custom style -->
    <link href="../css/bootstrap_css/ui.css" rel="stylesheet" type="text/css"/>
    <link href="../css/bootstrap_css/responsive.css" rel="stylesheet" media="only screen and (max-width: 1200px)" />

    <!-- custom javascript -->
    <script src="../js/bootstrap_js/script.js" type="text/javascript"></script>
    <script src="../js/apiRequest.js">

    <script type="text/javascript">
      /// some script

      // jquery ready start
      $(document).ready(function() {
	      // jQuery code

      }); 
      // jquery end
    </script>
  </head>
  <body>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="../js/apiRequest.js"></script>
    <header id="header" class="section-header">
	    <nav class="navbar navbar-top navbar-expand-lg navbar-dark bg-secondary">
		    <div class="container">
			    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
				    <span class="navbar-toggler-icon"></span>
			    </button>
			    <div class="collapse navbar-collapse" id="navbarNav">
				    <ul class="navbar-nav">
					    <li class="nav-item active">
						    <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
					    </li>
					    <li class="nav-item dropdown">
						    <a class="nav-link  dropdown-toggle" href="#" data-toggle="dropdown">  Dropdown  </a>
						    <ul class="dropdown-menu">
							    <li><a class="dropdown-item" href="#"> Menu item 1</a></li>
							    <li><a class="dropdown-item" href="#"> Menu item 2 </a></li>
						    </ul>
					    </li>
				    </ul>
			    </div>
		    </div> <!-- container //  -->
	    </nav>
	    <section class="header-main shadow">
		    <div class="container">
			    <div class="row align-items-center">
				    <div class="col-lg-3 col-sm-4">
					    <div class="brand-wrap">
						    <img class="logo" src="../images/icon.png">
						    <!--<h2 class="logo-text">LOGO</h2>-->
					    </div> <!-- brand-wrap.// -->
				    </div>
				    <div class="col-lg-6 col-sm-8">
					    <form action="#" class="search-wrap">
						    <div class="input-group w-100">
							    <input type="text" class="form-control" style="width:55%;" placeholder="Search">
							    <select class="custom-select"  name="category_name">
								    <option value="条件なし">条件なし</option>
								    <option value="和食">和食</option>
								    <option value="洋食">洋食</option>
								    <option value="中華">中華</option>
								    <option value="その他">その他</option>
							    </select>
							    <div class="input-group-append">
								    <button class="btn btn-primary" type="submit">
									    <i class="fa fa-search"></i>
								    </button>
							    </div>
						    </div>
					    </form> <!-- search-wrap .end// -->
				    </div> <!-- col.// -->
				    <a href="cart.html" class="widget-header mr-3">
					    <div class="icontext">
						    <div class="icon-wrap"><i class="icon-sm round border fa fa-shopping-cart"></i></div>
						    <div class="text-wrap">
							    <span class="small badge badge-danger">0</span>
							    <div>Cart</div>
						    </div>
					    </div>
				    </a>
				    <a href="login.html" class="widget-header mr-3">
					    <div class="icontext">
						    <div class="icon-wrap"><i class="icon-sm round border fa fa-user"></i></div>
						    <div class="text-wrap">
							    <small>Sing in<br>Sign up</small>
						    </div>
					    </div>
				    </a>
		      </div> <!-- row.// -->
		    </div> <!-- container.// -->
	    </section> <!-- header-main .// -->
    </header> <!-- section-header.// -->

    <section class="section-content bg padding-y border-top">
      <div class="container">
        <div class="row">
	        <main class="col-sm-9">

            <div id="history_card"></div>

	        </main> <!-- col.// -->
        </div>
      </div> <!-- container .//  -->
    </section>

    <script>
      user_id = 'goya';
      apiURI = 'http://54.238.92.95:8080/api/v1/purchase-histories/users/' + user_id;
      window.onload = function history() {
        apiResponse('GET',apiURI,'','',function(data){
          data.forEach(function(history){
            cart = '';
            history_date = history.date;
            total_price = history.total_price;
            total_point = history.total_point;
            cart += '<div class="card"><table class="table table-hover shopping-cart-wrap"><thead class="text-muted">';
            cart += '<tr><th scope="col">購入日：' + history_date + '</th>';
            //cart += '<th scope="col" class="small"><p>合計：</p>' + total_price + '円</th>';
            //cart += '<th scope="col" class="small"><p>合計：</p>' + total_point + 'P</th>';
            cart += '<th scope="col" width="120">食材</th><th scope="col" width="120">数量</th><th scope="col" width="120">人数分</th></tr></thead>';
          
            history.PurchaseHistoryCards.forEach(function(recipe){
              recipe_name = recipe.recipe_name;
              recipe_count = recipe.recipe_count;
              recipe_image_url = recipe.recipe_image_url;
              recipe_price = recipe.price;
              recipe_point = recipe.point;
              cart += '<tbody><tr><td><figure class="media"><div class="img-wrap"><img src="' + recipe_image_url + '" class="img-thumbna il img-sm"></div>';
              cart += '<figcaption class="media-body"><h6 class="title text-truncate">' + recipe_name+ '</h6>';
              cart += '<dl class="dlist-inline small"><dt>金額　　：</dt><dd>' + recipe_price + '</dd></dl>';
              cart += '<dl class="dlist-inline small"><dt>ポイント：</dt><dd>' + recipe_point + '</dd></dl>';
              cart += '<dl class="dlist-inline small"><dt>' + recipe_count + '</dt><dd>人前</dd></dl></figcaption></figure></td>';
              cart += '<td class="text-muted">';
            
              recipe.foods.forEach(function(details){
                food_name = details.food_name;
                cart += '<p>' + food_name + '</p>';
              });
              
              cart += '</td><td class="text-muted">';

              recipe.foods.forEach(function(details){
                food_quantity = details.food_quantity;
                cart += '<p>' + food_quantity + '</p>';
              });

              cart += '</td><td class="text-muted">';

              recipe.foods.forEach(function(details){
                food_count = details.food_count;
                cart += '<p>' + food_count + '</p>'
              });

              cart += '</td>';
            });
            
            cart += '</tr></tbody></table></div>'
            var doc_history_card = document.getElementById("history_card");
            doc_history_card.innerHTML = cart; //card部分表示
          });
        });
      };
    </script>
  </body>
</html>
